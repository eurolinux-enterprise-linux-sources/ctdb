From f7f138d9d6cfbd5987fc11546dbc720ec286d8f1 Mon Sep 17 00:00:00 2001
From: Sumit Bose <sbose@redhat.com>
Date: Mon, 19 Nov 2012 18:45:37 +0100
Subject: [PATCH] Print deleted nodes as well

---
 tools/ctdb.c | 15 ++++++++++++++-
 1 Datei geändert, 14 Zeilen hinzugefügt(+), 1 Zeile entfernt(-)

diff --git a/tools/ctdb.c b/tools/ctdb.c
index 904ec31..ef11ab3 100644
--- a/tools/ctdb.c
+++ b/tools/ctdb.c
@@ -499,6 +499,7 @@ static int control_status(struct ctdb_context *ctdb, int argc, const char **argv
 	struct ctdb_node_map *nodemap=NULL;
 	uint32_t recmode, recmaster;
 	int mypnn;
+	int num_deleted_nodes;
 
 	mypnn = ctdb_ctrl_getpnn(ctdb, TIMELIMIT(), options.pnn);
 	if (mypnn == -1) {
@@ -550,7 +551,19 @@ static int control_status(struct ctdb_context *ctdb, int argc, const char **argv
 		return 0;
 	}
 
-	printf("Number of nodes:%d\n", nodemap->num);
+	num_deleted_nodes = 0;
+	for(i=0;i<nodemap->num;i++){
+		if (nodemap->nodes[i].flags & NODE_FLAGS_DELETED) {
+			num_deleted_nodes++;
+		}
+	}
+
+	if (num_deleted_nodes == 0) {
+		printf("Number of nodes:%d\n", nodemap->num);
+	} else {
+		printf("Number of nodes:%d (including %d deleted nodes)\n",
+		       nodemap->num, num_deleted_nodes);
+	}
 	for(i=0;i<nodemap->num;i++){
 		static const struct {
 			uint32_t flag;
-- 
1.7.11.7

